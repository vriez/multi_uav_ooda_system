---
config:
  theme: base
  themeVariables:
    primaryColor: '#FFCDD2'
    primaryTextColor: '#000'
    primaryBorderColor: '#D32F2F'
    lineColor: '#333'
    secondaryColor: '#FFE082'
    tertiaryColor: '#BBDEFB'
  layout: elk
---
flowchart TB
    subgraph INIT["Mission Initialization"]
        START([Start SAR Mission])
        INIT_MISSION["Initialize Mission<br/>• Search area: 120m × 120m<br/>• 9 zones 40m × 40m each, 3×3 grid<br/>• Golden hour: 3-hour search window<br/>• Fleet: 4 UAVs with thermal cameras"]
        PRIORITIES["Search Grid Prioritization<br/>• High Priority P=0.9: Zones 1-3 top row<br/>  closest to LKP, water sources<br/>• Medium Priority P=0.6: Zones 4-6 middle row<br/>  travel corridors, shelters<br/>• Low Priority P=0.4: Zones 7-9 bottom row<br/>  remote areas"]
        ASSIGN["Initial Task Allocation<br/>• UAV-1 → Zones 1, 2 HIGH 8 min<br/>• UAV-2 → Zones 3, 4 HIGH/MED 8 min<br/>• UAV-3 → Zones 5, 6 MEDIUM 8 min<br/>• UAV-4 → Zones 7, 8, 9 LOW 12 min<br/>• Coverage rate: 1 zone per 4 min"]
    end

    subgraph EXEC["Execution Phase"]
        EXECUTE["Execute Search<br/>• Thermal imaging scan<br/>• Lawn mower pattern<br/>• 20% overlap for reliability<br/>• Golden hour countdown active"]
        FAILURE{Failure<br/>Detected?}
    end

    subgraph OODA_OBSERVE["OBSERVE Phase (T+0 to T+1.5s)"]
        OBSERVE["Failure Detection<br/>• UAV-2 GPS signal lost in ravine<br/>• 90-second timeout exceeded → failsafe RTL<br/>• Zones 3 HIGH and 4 MED abandoned<br/>• Fleet state:<br/>  - UAV-1: 75% battery, 20% spare<br/>  - UAV-3: 80% battery, 35% spare<br/>  - UAV-4: 78% battery, 30% spare"]
    end

    subgraph OODA_ORIENT["ORIENT Phase (T+1.5s to T+3.0s)"]
        ORIENT["Impact & Capacity Analysis<br/>• 22% coverage degradation 2/9 zones<br/>• 52 minutes remaining in golden hour<br/>• Capacity analysis:<br/>  - UAV-1: can absorb 1 zone<br/>  - UAV-3: can absorb 1 zone<br/>  - UAV-4: maintains 3-zone assignment<br/>• Priority strategy: Zone 3 HIGH to UAV-1"]
    end

    subgraph OODA_DECIDE["DECIDE Phase (T+3.0s to T+4.5s)"]
        DECIDE["Full Reallocation Plan<br/>• UAV-1: Zones 1, 2, 3 → 3 zones<br/>• UAV-3: Zones 4, 5, 6 → 3 zones<br/>• UAV-4: Zones 7, 8, 9 → 3 zones unchanged<br/>• Constraint verification:<br/>  - UAV-1: 23% projected 3% margin PASS<br/>  - UAV-3: 37% projected 17% margin PASS<br/>  - Collision: Sequential entry, 15m buffer PASS"]
    end

    subgraph OODA_ACT["ACT Phase (T+4.5s to T+6.0s)"]
        ACT["Command Dispatch<br/>• UAV-1: Add Zone 3 to assignment<br/>• UAV-3: Add Zone 4 to assignment<br/>• Priority: CRITICAL golden hour<br/>• Timeout: 200ms acknowledgment"]
    end

    subgraph CONTINUE["Mission Continuation"]
        MISSION_CONT["Post-Adaptation Status<br/>• Coverage Recovery: 100% 9/9 zones<br/>• Golden Hour Impact: 0.00003%<br/>• Constraint Violations: 0<br/>• Operator Escalation: None required<br/>• OODA Time: 1.2 milliseconds"]
    end

    %% Flow connections
    START --> INIT_MISSION
    INIT_MISSION --> PRIORITIES
    PRIORITIES --> ASSIGN
    ASSIGN --> EXECUTE
    EXECUTE --> FAILURE

    FAILURE -->|No| EXECUTE
    FAILURE -->|Yes| OBSERVE

    OBSERVE --> ORIENT
    ORIENT --> DECIDE
    DECIDE --> ACT
    ACT --> MISSION_CONT
    MISSION_CONT --> EXECUTE

    %% Styling
    classDef startEnd fill:#FFCDD2,stroke:#D32F2F,stroke-width:2px
    classDef init fill:#FFCDD2,stroke:#D32F2F,stroke-width:2px
    classDef process fill:#FFE082,stroke:#F57C00,stroke-width:2px
    classDef decision fill:#FFE082,stroke:#F57C00,stroke-width:3px
    classDef ooda fill:#BBDEFB,stroke:#1976D2,stroke-width:2px
    classDef success fill:#C8E6C9,stroke:#388E3C,stroke-width:2px

    class START startEnd
    class INIT_MISSION,PRIORITIES,ASSIGN init
    class EXECUTE process
    class FAILURE decision
    class OBSERVE,ORIENT,DECIDE,ACT ooda
    class MISSION_CONT success
