---
config:
  theme: base
  themeVariables:
    primaryColor: '#C8E6C9'
    primaryTextColor: '#000'
    primaryBorderColor: '#388E3C'
    lineColor: '#333'
    secondaryColor: '#FFE082'
    tertiaryColor: '#BBDEFB'
  layout: elk
---
flowchart TB
    subgraph INIT["Mission Initialization"]
        START([Start Surveillance Mission])
        INIT_MISSION["Initialize Mission<br/>• Operational area: 120m × 120m<br/>• 9 patrol zones 40m × 40m each, 3×3 grid<br/>• 2-hour continuous coverage requirement<br/>• Fleet: 6 UAVs, 30-min flight time each"]
        ASSIGN["Assign UAVs to Zones<br/>• High Priority P=0.9: Zones 1-3 top row, 8 waypoints<br/>• Medium Priority P=0.6: Zones 4-6 middle row, 6 waypoints<br/>• Low Priority P=0.4: Zones 7-9 bottom row, 4 waypoints<br/>• Set battery reserves 20% safety"]
    end

    subgraph EXEC["Execution Phase"]
        EXECUTE["Execute Patrol<br/>• UAVs fly zone loops<br/>• Telemetry at 2 Hz<br/>• Monitor battery levels<br/>• Wave rotation at 25-min mark"]
        FAILURE{Failure<br/>Detected?}
    end

    subgraph OODA_OBSERVE["OBSERVE Phase (T+0 to T+1.5s)"]
        OBSERVE["Failure Detection<br/>• UAV-3 battery anomaly: 8% vs expected 55%<br/>• Discharge rate: 8%/min vs 3%/min baseline<br/>• Zone 5 center at risk<br/>• Fleet state aggregation:<br/>  - UAV-2: 45% battery, 15% spare<br/>  - UAV-4: 40% battery, 12% spare"]
    end

    subgraph OODA_ORIENT["ORIENT Phase (T+1.5s to T+3.0s)"]
        ORIENT["Impact & Capacity Analysis<br/>• Zone 5 lost: 11.1% of mission area<br/>• Zone 5 priority: P=0.6 MEDIUM<br/>• Capacity check:<br/>  - UAV-2: 15% spare, needs 3% → FEASIBLE<br/>  - UAV-4: 12% spare, needs 3% → FEASIBLE<br/>• Strategy: Split Zone 5 between UAV-2 and UAV-4"]
    end

    subgraph OODA_DECIDE["DECIDE Phase (T+3.0s to T+4.5s)"]
        DECIDE["Reallocation Plan<br/>• Split Zone 5 into 5A north and 5B south<br/>• UAV-2: Zone 2 + Zone 5A 11 waypoints<br/>• UAV-4: Zone 6 + Zone 5B 9 waypoints<br/>• Constraint verification:<br/>  - Battery: PASS both >20% reserve<br/>  - Collision: PASS opposite patrol directions<br/>  - Spatial: PASS 15m buffer at boundary"]
    end

    subgraph OODA_ACT["ACT Phase (T+4.5s to T+5.5s)"]
        ACT["Command Dispatch<br/>• UAV-2: Extended waypoints Zone 2 + 5A<br/>• UAV-4: Extended waypoints Zone 6 + 5B<br/>• UAV-3: Emergency RTL battery critical 8%<br/>• Priority: HIGH, Timeout: 200ms"]
    end

    subgraph CONTINUE["Mission Continuation"]
        MISSION_CONT["Post-Adaptation Status<br/>• Coverage Recovery: 100%<br/>• Surveillance Quality: 91.7%<br/>  reduced density in Zone 5<br/>• Alert: CAUTION - coverage degraded<br/>• Operator Action: None required<br/>• OODA Time: 0.7 milliseconds"]
    end

    %% Flow connections
    START --> INIT_MISSION
    INIT_MISSION --> ASSIGN
    ASSIGN --> EXECUTE
    EXECUTE --> FAILURE

    FAILURE -->|No| EXECUTE
    FAILURE -->|Yes| OBSERVE

    OBSERVE --> ORIENT
    ORIENT --> DECIDE
    DECIDE --> ACT
    ACT --> MISSION_CONT
    MISSION_CONT --> EXECUTE

    %% Styling
    classDef startEnd fill:#C8E6C9,stroke:#388E3C,stroke-width:2px
    classDef init fill:#C8E6C9,stroke:#388E3C,stroke-width:2px
    classDef process fill:#C8E6C9,stroke:#388E3C,stroke-width:2px
    classDef decision fill:#FFE082,stroke:#F57C00,stroke-width:3px
    classDef ooda fill:#BBDEFB,stroke:#1976D2,stroke-width:2px
    classDef success fill:#C8E6C9,stroke:#388E3C,stroke-width:2px

    class START startEnd
    class INIT_MISSION,ASSIGN init
    class EXECUTE process
    class FAILURE decision
    class OBSERVE,ORIENT,DECIDE,ACT ooda
    class MISSION_CONT success
